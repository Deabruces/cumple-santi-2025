---
import Layout from '../layouts/Layout.astro';
---

<Layout
  title="Confirmar Asistencia - Cumplea√±os Santiago Saud"
  description="Confirma tu asistencia al cumplea√±os n√∫mero 10 de Santiago Saud"
>
  <main class="min-h-screen py-12 px-4">
    <div class="container mx-auto max-w-2xl relative z-10">
      <div class="text-center mb-8 animate-fade-in">
        <a href="/" class="inline-block text-green-500 hover:text-green-400 mb-6 transition-colors pixel-text text-xs gaming-glow">
          ‚Üê INICIO
        </a>

        <div class="inline-block mb-6 p-6 border-4 border-green-500 gaming-glow-strong relative">
          <div class="absolute -top-2 -left-2 w-4 h-4 bg-green-500"></div>
          <div class="absolute -top-2 -right-2 w-4 h-4 bg-green-500"></div>
          <div class="absolute -bottom-2 -left-2 w-4 h-4 bg-green-500"></div>
          <div class="absolute -bottom-2 -right-2 w-4 h-4 bg-green-500"></div>
          <h1 class="text-3xl md:text-5xl font-bold text-green-400 pixel-heading leading-tight">
            CONFIRMAR<br/>ASISTENCIA
          </h1>
        </div>

        <p class="text-lg text-green-300 pixel-heading">
          ¬°UNETE A LA PARTIDA!
        </p>
      </div>

      <!-- Form Card -->
      <div class="bg-black border-4 border-green-500 p-6 md:p-8 gaming-glow-strong animate-slide-up relative">
        <div class="absolute -top-2 -left-2 w-6 h-6 bg-green-500"></div>
        <div class="absolute -top-2 -right-2 w-6 h-6 bg-green-500"></div>
        <div class="absolute -bottom-2 -left-2 w-6 h-6 bg-green-500"></div>
        <div class="absolute -bottom-2 -right-2 w-6 h-6 bg-green-500"></div>

        <form id="confirmacion-form" class="space-y-5">
          <!-- Nombre del ni√±o -->
          <div>
            <label for="nombre_nino" class="block text-xs font-bold text-green-400 mb-2 pixel-text">
              NOMBRE JUGADOR <span class="text-red-500">*</span>
            </label>
            <select
              id="nombre_nino"
              name="nombre_nino"
              required
              class="w-full px-4 py-3 bg-black border-2 border-green-500 text-green-400 focus:outline-none focus:border-green-300 transition-all gaming-glow"
            >
              <option value="" class="bg-black">SELECCIONA EL NOMBRE</option>
              <option value="Santiago Saud" class="bg-black">Santiago Saud</option>
              <option value="Mateo Yanez" class="bg-black">Mateo Yanez</option>
              <option value="Leon Pe√±a" class="bg-black">Leon Pe√±a</option>
              <option value="Leon Sarnaki" class="bg-black">Leon Sarnaki</option>
              <option value="Facundo Hidalgo" class="bg-black">Facundo Hidalgo</option>
              <option value="Maximo Reyes" class="bg-black">Maximo Reyes</option>
              <option value="Mariano Castro" class="bg-black">Mariano Castro</option>
              <option value="Tomas Nieto" class="bg-black">Tomas Nieto</option>
              <option value="Valentin Gummusio" class="bg-black">Valentin Gummusio</option>
              <option value="Dominga Vergara" class="bg-black">Dominga Vergara</option>
              <option value="Emma Vidal" class="bg-black">Emma Vidal</option>
              <option value="Renata Quesada" class="bg-black">Renata Quesada</option>
            </select>
          </div>

          <!-- Nombre del padre/madre -->
          <div>
            <label for="nombre_padre" class="block text-xs font-bold text-green-400 mb-2 pixel-text">
              NOMBRE ADULTO <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="nombre_padre"
              name="nombre_padre"
              required
              class="w-full px-4 py-3 bg-black border-2 border-green-500 text-green-400 placeholder-green-700 focus:outline-none focus:border-green-300 transition-all gaming-glow"
              placeholder="EJ: MARIA GONZALEZ"
            />
          </div>

          <!-- Tel√©fono -->
          <div>
            <label for="telefono" class="block text-xs font-bold text-green-400 mb-2 pixel-text">
              TELEFONO
            </label>
            <input
              type="tel"
              id="telefono"
              name="telefono"
              class="w-full px-4 py-3 bg-black border-2 border-green-500 text-green-400 placeholder-green-700 focus:outline-none focus:border-green-300 transition-all gaming-glow"
              placeholder="+56 9 1234 5678"
            />
          </div>

          <!-- Email -->
          <div>
            <label for="email" class="block text-xs font-bold text-green-400 mb-2 pixel-text">
              EMAIL
            </label>
            <input
              type="email"
              id="email"
              name="email"
              class="w-full px-4 py-3 bg-black border-2 border-green-500 text-green-400 placeholder-green-700 focus:outline-none focus:border-green-300 transition-all gaming-glow"
              placeholder="CORREO@EJEMPLO.COM"
            />
          </div>

          <!-- Comentarios -->
          <div>
            <label for="comentarios" class="block text-xs font-bold text-green-400 mb-2 pixel-text">
              COMENTARIOS
            </label>
            <textarea
              id="comentarios"
              name="comentarios"
              rows="4"
              class="w-full px-4 py-3 bg-black border-2 border-green-500 text-green-400 placeholder-green-700 focus:outline-none focus:border-green-300 transition-all resize-none gaming-glow"
              placeholder="ALERGIAS, RESTRICCIONES, ETC..."
            ></textarea>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            id="submit-btn"
            class="w-full px-6 py-4 bg-green-500 hover:bg-green-400 text-black font-bold text-sm transition-all pixel-text gaming-glow-strong border-4 border-green-600 disabled:opacity-50 disabled:cursor-not-allowed active:translate-y-1"
          >
            <span id="btn-text">‚ñ∂ ENVIAR CONFIRMACION</span>
            <span id="btn-loading" class="hidden">
              ‚è≥ ENVIANDO...
            </span>
          </button>
        </form>

        <!-- Success Message -->
        <div id="success-message" class="hidden mt-6 p-4 bg-black border-2 border-green-500 relative">
          <div class="absolute -top-1 -left-1 w-3 h-3 bg-green-500"></div>
          <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500"></div>
          <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-green-500"></div>
          <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500"></div>
          <p class="text-green-400 font-semibold text-center pixel-text text-xs gaming-glow">
            ‚úÖ CONFIRMACION EXITOSA!<br/>
            <span class="text-green-300 text-xs">NOS VEMOS EL 19 DE OCTUBRE</span>
          </p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="hidden mt-6 p-4 bg-black border-2 border-red-500 relative">
          <div class="absolute -top-1 -left-1 w-3 h-3 bg-red-500"></div>
          <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500"></div>
          <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-red-500"></div>
          <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-red-500"></div>
          <p class="text-red-500 font-semibold text-center pixel-text text-xs">
            ‚ùå ERROR! INTENTA DE NUEVO
          </p>
        </div>
      </div>

      <!-- Info Box -->
      <div class="mt-8 bg-black border-2 border-green-500 p-6 animate-fade-in-delay gaming-glow relative">
        <div class="absolute -top-1 -left-1 w-3 h-3 bg-green-500"></div>
        <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500"></div>
        <div class="absolute -bottom-1 -left-1 w-3 h-3 bg-green-500"></div>
        <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500"></div>

        <h3 class="text-sm font-bold text-green-400 mb-3 pixel-text">üìã INFO DEL EVENTO</h3>
        <ul class="space-y-2 text-green-300 text-xs">
          <li>‚úì Edad: 8-12 a√±os</li>
          <li>‚úì Max: 12 invitados</li>
          <li>‚úì Incluye: Escape Room + Picnic</li>
          <li>‚úì Duracion: 3 horas (16:00 - 19:00)</li>
          <li>‚úì Lugar: Escapology, Parque Araucano</li>
        </ul>
      </div>
    </div>
  </main>
</Layout>

<script>
  const form = document.getElementById('confirmacion-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const btnText = document.getElementById('btn-text') as HTMLSpanElement;
  const btnLoading = document.getElementById('btn-loading') as HTMLSpanElement;
  const successMessage = document.getElementById('success-message') as HTMLDivElement;
  const errorMessage = document.getElementById('error-message') as HTMLDivElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Hide previous messages
    successMessage.classList.add('hidden');
    errorMessage.classList.add('hidden');

    // Show loading state
    submitBtn.disabled = true;
    btnText.classList.add('hidden');
    btnLoading.classList.remove('hidden');

    const formData = new FormData(form);
    const data = {
      nombre_nino: formData.get('nombre_nino'),
      nombre_padre: formData.get('nombre_padre'),
      telefono: formData.get('telefono'),
      email: formData.get('email'),
      comentarios: formData.get('comentarios'),
    };

    try {
      const response = await fetch('/api/confirmar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        successMessage.classList.remove('hidden');
        form.reset();
        // Scroll to success message
        successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else {
        errorMessage.classList.remove('hidden');
      }
    } catch (error) {
      console.error('Error:', error);
      errorMessage.classList.remove('hidden');
    } finally {
      // Reset button state
      submitBtn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }
  });
</script>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.8s ease-out forwards;
  }

  .animate-fade-in-delay {
    opacity: 0;
    animation: fade-in 0.8s ease-out 0.3s forwards;
  }

  .animate-slide-up {
    opacity: 0;
    animation: slide-up 0.8s ease-out 0.2s forwards;
  }
</style>
